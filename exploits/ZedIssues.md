# Genaral Information
1. Siren damages players after she is decapped (has - health).
2. Husk shoots fireball after he is dead.
3. Crawler has collision issues.
4. Zed to zed damage spamms to log, a lot.
5. Fleshpound makes all zeds to spin like crazy.

# Exploits reasons
1. `KFChar/ZombieSiren.uc#112 SpawnTwoShots()`
```unrealscript
simulated function SpawnTwoShots()
{
    // no checks if we are decapped or no
    if( bZapped )
    {
        return;
    }
    ...
}
```
2. If `Husk` started his fireball launching animation nothing can interupt him. Even if you wipe him to meat and blood, fireball will be spawned anyways and does his job.
3. Crawler jumps very fast and his pawn is not being destroyed that quick to make the transition smooth.
4. `KFMod/KFMonster.uc#2631 TakeDamage()`
```unrealscript
function TakeDamage(int Damage, Pawn instigatedBy, Vector hitlocation, Vector momentum, class<DamageType> damageType, optional int HitIndex )
{
    ...
    // 2nd check will spam log with none warnings if damage was dealth by a zed (no player pawn)
    if ( damageType != none && LastDamagedBy.IsPlayerPawn() && LastDamagedBy.Controller != none )
    {
        if ( KFMonsterController(Controller) != none )
        {
            KFMonsterController(Controller).AddKillAssistant(LastDamagedBy.Controller, FMin(Health, Damage));
        }
    }
    ...
}
```
5. `KFMod/FleshPoundAvoidArea.uc#41`
```unrealscript
function bool RelevantTo(Pawn P)
{
    // no zed health / specie check
    return ( KFMonst != none && VSizeSquared(KFMonst.Velocity) >= 75 && Super.RelevantTo(P)
    && KFMonst.Velocity dot (P.Location - KFMonst.Location) > 0  );
}
```

## #1: Siren Aftershock

[Video demonstration #1](STUB!)


## #4: Zed2Zed Damage Log Spam
You open your server logs and find out that

`Warning: ZombieClot_STANDARD KF-Solo-Bioticslab.ZombieClot_STANDARD (Function KFMod.KFMonster.TakeDamage:02FC) Accessed None 'LastDamagedBy'`

Lines take the good half of the file. It makes navigating and administrating much harder in this mess and ofc this massive logging decreases preformance.

## #5: Fleshpound Spinning Madness
When you rage a FP it during it's animation all zeds that touch him will be spinned several times. This makes headshots much much harder to achieve, and for dual, triple FP's almost suicidal mission.

[Video demonstration #1](https://youtu.be/kLd-TJzyzBE)

# Proposed Fixes
1. Add `bDecapitated` check to deflect damage. 

`KFChar/ZombieSiren.uc#112 SpawnTwoShots()`
```unrealscript
simulated function SpawnTwoShots()
{
    if( bZapped || bDecapitated )
    {
        return;
    }
    ...
}
```
And edit `ZombieDying` state so it won't let sirens to do any animation / damage, etc (well since she's dead...).
```unrealscript
State ZombieDying
{
ignores AnimEnd, Trigger, Bump, HitWall, HeadVolumeChange, PhysicsVolumeChange, Falling, BreathTimer, Died, RangedAttack, SpawnTwoShots;
}
```

2. 

4. Add `LastDamagedBy != none` check.

`KFMod/KFMonster.uc#2631 TakeDamage()`
```unrealscript
function TakeDamage(int Damage, Pawn instigatedBy, Vector hitlocation, Vector momentum, class<DamageType> damageType, optional int HitIndex )
{
    ...
    // 2nd check will spam log with none warnings if damage was dealth by a zed (no player pawn)
    if ( damageType != none && && LastDamagedBy != none && LastDamagedBy.IsPlayerPawn() && LastDamagedBy.Controller != none )
    {
        if ( KFMonsterController(Controller) != none )
        {
            KFMonsterController(Controller).AddKillAssistant(LastDamagedBy.Controller, FMin(Health, Damage));
        }
    }
    ...
}
```

5. Let's add zed health check and exclude at least FP's.

`KFMod/FleshPoundAvoidArea.uc#41`
```unrealscript
function bool RelevantTo(Pawn P)
{
    if(KFMonst == none || KFMonst.Health >= 1500)
        return false;
    return ( VSizeSquared(KFMonst.Velocity) >= 75 && Super.RelevantTo(P)
    && KFMonst.Velocity dot (P.Location - KFMonst.Location) > 0  );
}
```
